# Movies Test

## Installation

See `Dockerfile.dev` for detailed instructions on how to setup the environment. You can use this Dockerfile if you have an extension like [Dev Containers](https://code.visualstudio.com/docs/devcontainers/containers) so you don't have to setup C++ compiler, CMake and related stuff which is needed to compile the project.

After that, follow these steps to compile the project and tests:
```{sh}
conan install . --output-folder=build
cd build
cmake .. -DCMAKE_TOOLCHAIN_FILE=conan_toolchain.cmake -DCMAKE_BUILD_TYPE=Release
make
```

## Running tests

Just run the following command in the `build` folder:

```{sh}
make MoviesTestTests
```

Only non-trivial use cases and repositories have been tested. Serialization/deserialization code in controllers is not worth testing because it has been
autogenerated by AI. Instead of testing that, it's better to write a code generation script for that.

As an alternative, you can run the container using the `Dockerfile.test` provided (for example to use it in a CI Server)

## Running

Just run the following command in the `build` folder:

```{sh}
make MoviesTestServer
```

As an alternative, you can run the container using the `Dockerfile` provided

An HTTP server will open on port 8080, with the following endpoints available:
- GET /api/movies?page=1&pageSize=20: lists all available movies
- GET /api/theaters?movieId=123: shows the theaters showing a specific movie.
- GET /api/seats?movieId=123&theaterId=123&sinceDate=2023-07-29T18%3A00%3A33.047Z: shows the available seats for a specific movie on a theater at a specific time.
- PUT /api/book-seats: book a specific number of seats for a movie on a theater at a specific time. The input is the following JSON body:
```{json}
{
    "movieId": "123",
    "theaterId": "123",
    "sinceDate": "2023-07-29T18:00:33.047Z",
    "seats": ["a1", "a2", ...]
}
```

## Generating documentation

Run `doxygen` and documentation will be available under `docs` folder in `html` and `latex` formats
